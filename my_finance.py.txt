import streamlit as st
import pandas as pd
import json
import os

# --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø© (Ù„Ø¶Ù…Ø§Ù† Ø¯ÙŠÙ…ÙˆÙ…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) ---
DB_FILE = "financial_data.json"

def load_data():
    if os.path.exists(DB_FILE):
        with open(DB_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    else:
        # Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ Ø§Ø³ØªØ®Ø±Ø¬Ù†Ø§Ù‡Ø§ Ù…Ù† Ù…Ù„ÙØ§ØªÙƒ
        return {
            'investments': {
                'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ Ø§Ù„Ù…Ø±Ù† (Ù…Ø­Ù„ÙŠ)': 92057.38,
                'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ Ø§Ù„Ù‚ÙŠØ§Ø¯ÙŠ (Ù…Ø­Ù„ÙŠ)': 65964.96,
                'Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ Ø§Ù„Ù†Ø´Ø· (Ù…Ø­Ù„ÙŠ)': 63249.39,
                'Ù…Ø´ÙˆØ±Ø© Ù†Ù…Ùˆ (Ø¹Ø§Ù„Ù…ÙŠ)': 19823.00,
                'Ù…Ø´ÙˆØ±Ø© ØªÙˆØ²ÙŠØ¹Ø§Øª (Ø¹Ø§Ù„Ù…ÙŠ)': 2656.00,
                'Ø¯Ø±Ø§ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ù…Ø­Ù„ÙŠ)': 3576.28
            },
            'debts': {
                'Ø§Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ': 624227.45,
                'Ø§Ù„Ù‚Ø±Ø¶ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ': 104882.85
            }
        }

def save_data(data):
    with open(DB_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=4)

# --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
if 'db' not in st.session_state:
    st.session_state.db = load_data()

# --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Streamlit UI) ---
st.title("ğŸ›¡ï¸ Ù…Ø­ÙØ¸ØªÙŠ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¢Ù…Ù†Ø©")

# (Ø¨Ù‚ÙŠØ© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©)

# --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ---
with st.expander("ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… ÙˆØ­ÙØ¸Ù‡Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹"):
    with st.form("edit_form"):
        updated_investments = {}
        for name, val in st.session_state.db['investments'].items():
            updated_investments[name] = st.number_input(f"ØªØ¹Ø¯ÙŠÙ„ {name}", value=val)
        
        if st.form_submit_button("Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ø£Ø¨Ø¯"):
            st.session_state.db['investments'] = updated_investments
            save_data(st.session_state.db) # Ù‡Ù†Ø§ ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ù„Ù
            st.success("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­!")
